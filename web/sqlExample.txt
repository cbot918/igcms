-- SCHEME

CREATE TABLE "users"();
ALTER TABLE "users" ADD "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY;
ALTER TABLE "users" ADD "name" VARCHAR(50);
ALTER TABLE "users" ADD "email" VARCHAR(50);
ALTER TABLE "users" ADD "password" VARCHAR(50);

CREATE TABLE "profile"();
ALTER TABLE "profile" ADD "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY;
ALTER TABLE "profile" ADD "user_id" INT; 
ALTER TABLE "profile" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");
ALTER TABLE "profile" ADD "photo" VARCHAR(200);

CREATE TABLE "post"();
ALTER TABLE "post" ADD "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY;
ALTER TABLE "post" ADD "user_id" INT;
ALTER TABLE "post" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id");
ALTER TABLE "post" ADD "title" VARCHAR(200);
ALTER TABLE "post" ADD "contents" VARCHAR(300);

CREATE TABLE "comment"();
ALTER TABLE "comment" ADD "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY;
ALTER TABLE "comment" ADD "post_id" INT;
ALTER TABLE "comment" ADD FOREIGN KEY ("post_id") REFERENCES "post" ("id");

CREATE TABLE "comment_detail"();
ALTER TABLE "comment_detail" ADD "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY;
ALTER TABLE "comment_detail" ADD "comment_id" INT;
ALTER TABLE "comment_detail" ADD FOREIGN KEY ("comment_id") REFERENCES "comment" ("id");
ALTER TABLE "comment_detail" ADD "content" VARCHAR(300);




-- INSERT

INSERT INTO profile (user_id, photo) VALUES (1,'https://unsplash.com/photos/Pk0xvWMbuok');

INSERT INTO post (user_id, title, contents) VALUES (1, 'first post', 'today is a good day');



-- SELECT INNER JOIN

SELECT * 
FROM users
INNER JOIN profile
ON users.id = profile.user_id
;


-- ALTER TABLE

ALTER TABLE post RENAME COLUMN content to contents ;

ALTER TABLE post
ALTER COLUMN title
TYPE VARCHAR(200)
;

ALTER TABLE post
ALTER COLUMN contents
TYPE VARCHAR(300)
;




INSERT INTO users (name, email, password) VALUES ('cat','cat@gmail.com','cat12345');

INSERT INTO profile (user_id, photo) VALUES (1,'https://unsplash.com/photos/Pk0xvWMbuok');

SELECT * 
FROM users
INNER JOIN profile
ON users.id = profile.user_id
;

INSERT INTO post (user_id, title, contents) VALUES (3, 'cat post', 'today is a cat day');

SELECT * 
FROM users
INNER JOIN post
ON users.id = post.user_id
;

INSERT INTO comment (post_id) VALUES (1);

INSERT INTO comment_detail (comment_id, contents) VALUES (1, '沙發');


SELECT * FROM users
INNER JOIN post
ON users.id = post.user_id
WHERE name ='yale'

SELECT name,pid,title,cid,post_content

FROM(( users
	INNER JOIN post
	ON users.id = post.user_id 
	)
		INNER JOIN comment
		ON post.pid = comment.post_id)
			INNER JOIN comment_detail
			ON comment.cid = comment_detail.comment_id

WHERE name = 'yale'


UNION
SELECT * FROM post
INNER JOIN comment
ON post.id = comment.post_id






